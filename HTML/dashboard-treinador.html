<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Treinador - Academia Pinga</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../CSS/styles.css">
    <link rel="stylesheet" href="../CSS/user-menu.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../JS/user-menu.js" defer></script>
    <link rel="icon" type="image/png" href="../IMG/favicon_sem_fundo.png">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="../index.html" class="nav-logo">
                <img src="../IMG/academia_pinga_sem_fundo.png" alt="Academia Pinga" style="height: 50px; margin-right: 10px;">
                Academia Pinga
            </a>
            <button class="mobile-menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="planos.html">Planos</a>
                <a href="treinadores.html">Treinadores</a>
                <a href="decks.html">Decks</a>
                <a href="sobre.html">Sobre</a>
                <a href="avaliacoes.html">Avaliações</a>
                <a href="outros-jogos.html">Outros Jogos</a>
                <a href="../login.html" id="loginLink">Iniciar Sessão/Registo</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>Dashboard do Treinador</h1>
            <div class="treinador-info">
                <img id="treinadorAvatar" src="" alt="Avatar do Treinador" class="treinador-avatar">
                <div class="treinador-detalhes">
                    <h2 id="treinadorNome"></h2>
                    <p id="treinadorEspecialidade"></p>
                </div>
            </div>
        </div>

        <div class="dashboard-content">
            <div class="agendamentos-section">
                <h2>Agendamentos</h2>
                <div class="filtros-agendamentos">
                    <select id="filtroStatus">
                        <option value="todos">Todos os Status</option>
                        <option value="pendente">Pendentes</option>
                        <option value="confirmado">Confirmados</option>
                        <option value="cancelado">Cancelados</option>
                    </select>
                    <select id="filtroData">
                        <option value="todos">Todas as Datas</option>
                        <option value="hoje">Hoje</option>
                        <option value="semana">Esta Semana</option>
                        <option value="mes">Este Mês</option>
                    </select>
                </div>
                <div id="listaAgendamentos" class="lista-agendamentos">
                    <!-- Os agendamentos serão inseridos aqui via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }

        .dashboard-header {
            margin-bottom: 40px;
        }

        .treinador-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .treinador-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .treinador-detalhes h2 {
            margin: 0;
            color: #333;
        }

        .treinador-detalhes p {
            margin: 5px 0 0;
            color: #666;
        }

        .agendamentos-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .filtros-agendamentos {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .filtros-agendamentos select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .lista-agendamentos {
            display: grid;
            gap: 15px;
        }

        .agendamento-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }

        .agendamento-info h3 {
            margin: 0;
            color: #333;
        }

        .agendamento-info p {
            margin: 5px 0;
            color: #666;
        }

        .agendamento-acoes {
            display: flex;
            gap: 10px;
        }

        .btn-confirmar {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-cancelar {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-pendente {
            background: #FFC107;
            color: #000;
        }

        .status-confirmado {
            background: #4CAF50;
            color: white;
        }

        .status-cancelado {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .treinador-info {
                flex-direction: column;
                text-align: center;
            }

            .filtros-agendamentos {
                flex-direction: column;
            }

            .agendamento-card {
                grid-template-columns: 1fr;
            }

            .agendamento-acoes {
                justify-content: center;
            }
        }
    </style>

    <script>
        // Inicialização do Supabase
        const supabaseUrl = 'https://vhswdfifhhcqmtpnhoso.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZoc3dkZmlmaGhjcW10cG5ob3NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ4NTUzMDksImV4cCI6MjA2MDQzMTMwOX0.Q50xEMRQLTjuOKtn0f92GX5NKY9GgWWYVfHlmE5yhUs'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        // Verificar autenticação e carregar dados
        async function carregarDashboard() {
            const { data: { user }, error: userError } = await supabase.auth.getUser();
            
            if (userError || !user) {
                window.location.href = '../login.html?redirect=dashboard-treinador.html';
                return;
            }

            // Carregar informações do treinador
            const { data: treinador, error: treinadorError } = await supabase
                .from('treinadores')
                .select('*')
                .eq('user_id', user.id)
                .single();

            if (treinadorError) {
                console.error('Erro ao carregar dados do treinador:', treinadorError);
                return;
            }

            // Atualizar informações na interface
            document.getElementById('treinadorAvatar').src = treinador.avatar_url || '../IMG/default-avatar.png';
            document.getElementById('treinadorNome').textContent = treinador.nome;
            document.getElementById('treinadorEspecialidade').textContent = treinador.especialidade;

            // Carregar agendamentos
            carregarAgendamentos();
        }

        // Carregar agendamentos
        async function carregarAgendamentos() {
            const { data: { user } } = await supabase.auth.getUser();
            const statusFiltro = document.getElementById('filtroStatus').value;
            const dataFiltro = document.getElementById('filtroData').value;

            let query = supabase
                .from('agendamentos')
                .select(`
                    *,
                    alunos:aluno_id (
                        nome,
                        email
                    )
                `)
                .eq('treinador_id', user.id);

            // Aplicar filtros
            if (statusFiltro !== 'todos') {
                query = query.eq('status', statusFiltro);
            }

            if (dataFiltro !== 'todos') {
                const hoje = new Date();
                const inicioSemana = new Date(hoje.setDate(hoje.getDate() - hoje.getDay()));
                const inicioMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);

                switch (dataFiltro) {
                    case 'hoje':
                        query = query.eq('data', new Date().toISOString().split('T')[0]);
                        break;
                    case 'semana':
                        query = query.gte('data', inicioSemana.toISOString().split('T')[0]);
                        break;
                    case 'mes':
                        query = query.gte('data', inicioMes.toISOString().split('T')[0]);
                        break;
                }
            }

            const { data: agendamentos, error } = await query.order('data', { ascending: true });

            if (error) {
                console.error('Erro ao carregar agendamentos:', error);
                return;
            }

            // Atualizar lista de agendamentos
            const listaAgendamentos = document.getElementById('listaAgendamentos');
            listaAgendamentos.innerHTML = '';

            agendamentos.forEach(agendamento => {
                const card = document.createElement('div');
                card.className = 'agendamento-card';
                card.innerHTML = `
                    <div class="agendamento-info">
                        <h3>${agendamento.alunos.nome}</h3>
                        <p>Data: ${new Date(agendamento.data).toLocaleDateString('pt-PT')}</p>
                        <p>Hora: ${agendamento.hora}</p>
                        <p>Duração: ${agendamento.duracao} hora(s)</p>
                        <p>Objetivos: ${agendamento.objetivos || 'Não especificado'}</p>
                        <span class="status-badge status-${agendamento.status}">${agendamento.status}</span>
                    </div>
                    <div class="agendamento-acoes">
                        ${agendamento.status === 'pendente' ? `
                            <button class="btn-confirmar" onclick="atualizarStatus('${agendamento.id}', 'confirmado')">
                                Confirmar
                            </button>
                            <button class="btn-cancelar" onclick="atualizarStatus('${agendamento.id}', 'cancelado')">
                                Cancelar
                            </button>
                        ` : ''}
                    </div>
                `;
                listaAgendamentos.appendChild(card);
            });
        }

        // Atualizar status do agendamento
        async function atualizarStatus(agendamentoId, novoStatus) {
            const { error } = await supabase
                .from('agendamentos')
                .update({ status: novoStatus })
                .eq('id', agendamentoId);

            if (error) {
                console.error('Erro ao atualizar status:', error);
                alert('Erro ao atualizar status do agendamento.');
                return;
            }

            // Recarregar agendamentos
            carregarAgendamentos();
        }

        // Event listeners para filtros
        document.getElementById('filtroStatus').addEventListener('change', carregarAgendamentos);
        document.getElementById('filtroData').addEventListener('change', carregarAgendamentos);

        // Carregar dashboard ao iniciar
        carregarDashboard();
    </script>
</body>
</html> 